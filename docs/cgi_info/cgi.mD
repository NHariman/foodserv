# CGI (Common Gateway Interface)

## What is it?
CGI stands for Common Gateway Interface, it is a standard for external gateway programs to interface with information servers (like HTTP servers).

CGI applications are usually written in scripting languages such as Perl, however nowadays they're also written in other languages, generally they get the file extension `.cgi`, but they can also end in others like `.py` for python etc.

It is used whe the webserver needs to dynamically interact with a user, usually this is then done in the way of a user filling in a form and submitting this to the server. the CGI retrieves the data, processes it and returns the result back to the webserver and then to the user.

### Features of a CGI
- applications run on the server
- reusable pieces of code
- well defined standard supported by most modern browsers
- interface is consistent, ca be written in many languages like C, C++, Python, Java, PERL.
- person writing the CGI can write it independently of the OS which the server uses
- simple basic way of passign information about the user's request from the webserver to the application program and getting a response back.
- by default, CGI scripts run in the security context of the server.

<img src="https://electricalfundablog.com/ezoimgfmt/i0.wp.com/electricalfundablog.com/wp-content/uploads/2020/01/Common-Gateway-Interface-CGI-Application_thumb.jpg?resize=640%2C289&ssl=1&ezimgfmt=rs:640x289/rscb12/ng:webp/ngcb12">

## How to use it?
The CGI script is usually found at a certain URL which should run the script. Generally speaking it follows the following steps:
- a diectory is created within the webserver which contains the scripts. This is folder is usually calld `cgi-bin`.
- The user sends a request to the server in the form of `http://mywebsite.com/cgi-bin/mycgiscript.pl`
- The server recognises the file being requested is a CGI script and instead of sending back the file it runs the script and passes the output of the script to the web client.

## CGI processing
When an HTTP server receives a request for a CGI script, the server gives the script the details of the request. There are 4 major ways in which a HTTP server an CGI script communicate:

1. **Enviroment variables**, HTTP server uses environment variables to pass information about the request to the CGI script. Depending on the type of request the variables may or may not contain information required by the script to function properly.

2. **The command line**, mostly used for `isindex` queries. However, `isindex` queries are dissuaded as it can cause security risks due to direct communicating with the command line.

3. **standard input**, for HTTP `POST` and `PUT` queries. The HTTP server communicates the information to the CGI script via standard input. The amount of information writtent o the standard input is stored in the `CONTENT_LENGTH` environment variable.

4. **Standard output** A script returns its output on the standard output. The output can be a document generated by the script, or instructions to the server for retrieved the desired output.

## Appropriate HTTP headers

| HTTP Header      | Description |
| ----------- | ----------- |
| Content-type: string      | Format of the file is being returned as a string.       |
| Content-type: string    | variable which sends back the length of the data in bytes. Used for the broswer to determine how much time is needed to download the result, used in the POST method        |
| Location: URL string     |  This can be used to redirect a  request to any file. The URL string specified ddepicts the URL to be returned instead of the URL which is requested       |
| Expires: Date string      |  Date string is used by the browser to determine when the page expires and needs refreshing. The format is: dd mon yyyy hh:mm:ss    |
| Set-Cookie: string      |  cookie passed as a string to be set    |

## Environment variables
CGI programs also use environment variables, all programs have access to the following variables

| HTTP Header      |  Description    |
| ----------- | ----------- |
| content-type      |  Used when a file is uploaded from the user. Depicts the data type of the content attached    |
| http_user_agent      |  gives info about the browser who initiated the request    |
| query_string      |  used in GET requests, it's the URL-encoded information sent from the browser    |
| content_length      |  used with POST request. Gives info about the length of the query information    |
| script_name      |  name of CGI script    |
| path_info      |  full path where CGI script is kept    |

# Resources
[Common Gateway Interface (CGI) â€“ How it Works, Features & Applications](https://electricalfundablog.com/common-gateway-interface-cgi/)

[CGI environement Variables](https://www.cs.ait.ac.th/~on/O/oreilly/perl/perlnut/ch09_04.htm)

[How the web works: HTTP and CGI explained](https://www.garshol.priv.no/download/text/http-tut.html)

